# OwlMail vs MailDev 功能对比分析

## 项目概述

- **OwlMail**: Go 语言实现的邮件开发测试工具
- **MailDev**: Node.js 实现的邮件开发测试工具（版本 2.2.1）

## 核心功能对比

### ✅ 共同功能

| 功能 | OwlMail | MailDev | 说明 |
|------|---------|---------|------|
| SMTP 服务器接收邮件 | ✅ | ✅ | 默认端口 1025 |
| Web API (REST) | ✅ | ✅ | 提供 RESTful API |
| Web UI 界面 | ✅ | ✅ | 网页界面查看邮件 |
| WebSocket 实时更新 | ✅ | ✅ | 实时同步邮件状态 |
| 邮件存储和持久化 | ✅ | ✅ | 支持邮件目录存储 |
| 邮件转发/中继 | ✅ | ✅ | 支持转发到外部 SMTP |
| 自动中继模式 | ✅ | ✅ | 自动转发所有邮件 |
| HTTP Basic Auth | ✅ | ✅ | Web 界面认证 |
| HTTPS 支持 | ✅ | ✅ | 支持 HTTPS |
| TLS/STARTTLS | ✅ | ✅ | SMTP 服务器 TLS 支持 |
| SMTP 认证 | ✅ | ✅ | 入站 SMTP 认证 |
| 附件支持 | ✅ | ✅ | 查看和下载附件 |
| 邮件下载 (.eml) | ✅ | ✅ | 下载原始邮件文件 |
| 邮件源码查看 | ✅ | ✅ | 查看原始邮件源码 |
| 健康检查 | ✅ | ✅ | `/healthz` 端点 |
| 环境变量兼容性 | ✅ | ✅ | OwlMail 完全支持 MailDev 环境变量（优先使用 MailDev 环境变量） |

### 🔄 功能差异

#### 1. API 端点差异

**完整的 API 端点对比表：**

| 端点 | 方法 | OwlMail | MailDev | 说明 |
|------|------|---------|---------|------|
| `/email` | GET | ✅ | ✅ | 获取所有邮件（支持分页和过滤） |
| `/email/:id` | GET | ✅ | ✅ | 获取单个邮件详情 |
| `/email/:id/html` | GET | ✅ | ✅ | 获取邮件 HTML 内容 |
| `/email/:id/attachment/:filename` | GET | ✅ | ✅ | 下载邮件附件 |
| `/email/:id/download` | GET | ✅ | ✅ | 下载原始邮件文件 (.eml) |
| `/email/:id/source` | GET | ✅ | ✅ | 获取邮件原始源码 |
| `/email/:id` | DELETE | ✅ | ✅ | 删除单个邮件 |
| `/email/all` | DELETE | ✅ | ✅ | 删除所有邮件 |
| `/email/read-all` | PATCH | ✅ | ✅ | 标记所有邮件为已读 |
| `/email/:id/read` | PATCH | ✅ | ❌ | 标记单个邮件为已读（OwlMail 独有） |
| `/email/:id/relay` | POST | ✅ | ❌ | 转发邮件（请求体方式，OwlMail 独有） |
| `/email/:id/relay/:relayTo?` | POST | ✅ | ✅ | 转发邮件（URL 参数方式） |
| `/email/stats` | GET | ✅ | ❌ | 邮件统计信息（OwlMail 独有） |
| `/email/preview` | GET | ✅ | ❌ | 邮件预览（轻量级，OwlMail 独有） |
| `/email/batch/delete` | POST | ✅ | ❌ | 批量删除邮件（OwlMail 独有） |
| `/email/batch/read` | POST | ✅ | ❌ | 批量标记已读（OwlMail 独有） |
| `/email/export` | GET | ✅ | ❌ | 导出所有邮件为 ZIP（OwlMail 独有） |
| `/config` | GET | ✅ | ✅ | 获取应用配置信息 |
| `/config/outgoing` | GET | ✅ | ❌ | 获取出站配置详情（OwlMail 独有） |
| `/config/outgoing` | PUT | ✅ | ❌ | 更新出站配置（OwlMail 独有） |
| `/config/outgoing` | PATCH | ✅ | ❌ | 部分更新出站配置（OwlMail 独有） |
| `/healthz` | GET | ✅ | ✅ | 健康检查端点 |
| `/reloadMailsFromDirectory` | GET | ✅ | ✅ | 从目录重新加载邮件 |
| `/socket.io` | WebSocket | ✅ | ✅ | WebSocket 连接（实现方式不同） |

**OwlMail 独有的端点：**
- `GET /email/stats` - 邮件统计信息
- `GET /email/preview` - 邮件预览（轻量级）
- `POST /email/batch/delete` - 批量删除邮件
- `POST /email/batch/read` - 批量标记已读
- `GET /email/export` - 导出所有邮件为 ZIP
- `PATCH /email/:id/read` - 标记单个邮件为已读
- `PUT /config/outgoing` - 更新出站配置
- `PATCH /config/outgoing` - 部分更新出站配置
- `GET /config/outgoing` - 获取出站配置

**两者都支持的端点：**
- `GET /email` - 获取所有邮件（支持分页和过滤）
- `GET /email/:id` - 获取单个邮件详情
- `GET /email/:id/html` - 获取邮件 HTML 内容
- `GET /email/:id/attachment/:filename` - 下载邮件附件
- `GET /email/:id/download` - 下载原始邮件文件 (.eml)
- `GET /email/:id/source` - 获取邮件原始源码
- `DELETE /email/:id` - 删除单个邮件
- `DELETE /email/all` - 删除所有邮件
- `PATCH /email/read-all` - 标记所有邮件为已读
- `POST /email/:id/relay/:relayTo?` - 转发邮件（MailDev 支持可选 URL 参数）
- `GET /config` - 获取应用配置信息
- `GET /healthz` - 健康检查端点
- `GET /reloadMailsFromDirectory` - 从目录重新加载邮件

**功能相同但实现不同的端点：**
- `PATCH /email/read-all` - 两者都支持，但 OwlMail 还额外支持 `PATCH /email/:id/read` 标记单个邮件
- `POST /email/:id/relay` - OwlMail 支持两种方式：
  - `POST /email/:id/relay` - 通过请求体传递 relayTo 参数
  - `POST /email/:id/relay/:relayTo` - 通过 URL 参数传递（与 MailDev 兼容）
  - MailDev 仅支持 `POST /email/:id/relay/:relayTo?`（可选 URL 参数）
- `GET /config` - 两者都支持，但 OwlMail 还额外提供：
  - `GET /config/outgoing` - 获取出站配置详情
  - `PUT /config/outgoing` - 更新出站配置
  - `PATCH /config/outgoing` - 部分更新出站配置

#### 2. WebSocket 实现差异

| 项目 | 实现方式 | 客户端要求 |
|------|---------|-----------|
| OwlMail | 原生 WebSocket (gorilla/websocket) | 标准 WebSocket API |
| MailDev | Socket.io | 需要 Socket.io 客户端库 |

**影响：**
- OwlMail 的 WebSocket 更轻量，兼容性更好
- MailDev 的 Socket.io 提供更多功能（自动重连、房间等），但需要额外的客户端库

#### 3. Web UI 差异

| 特性 | OwlMail | MailDev |
|------|---------|---------|
| 界面语言 | 中文 | 英文 |
| 前端框架 | 原生 JavaScript | AngularJS |
| 响应式设计 | ✅ | ✅ |
| 暗色主题 | ✅ | ✅ |

#### 4. 自动中继规则

| 项目 | 规则支持 | 配置方式 |
|------|---------|---------|
| OwlMail | ✅ | 完全支持 JSON 文件配置规则（`--auto-relay-rules`），格式与 MailDev 兼容 |
| MailDev | ✅ | 支持 JSON 文件配置规则（`--auto-relay-rules`） |

**规则格式（两者完全兼容）：**
```json
[
  { "allow": "*" },
  { "deny": "*@test.com" },
  { "allow": "ok@test.com" }
]
```

**规则处理逻辑（两者一致）：**
- 规则按顺序处理
- 最后匹配的规则生效（last matching rule wins）
- 支持通配符 `*` 匹配

#### 5. 邮件过滤和分页

| 功能 | OwlMail | MailDev |
|------|---------|---------|
| 分页 | ✅ (limit/offset 参数) | ✅ (skip 参数) |
| 过滤 | ✅ (全文搜索、发送者、接收者、日期、已读状态) | ✅ (点号语法，支持任意字段) |
| 排序 | ✅ (按时间、主题排序) | ❌ |

**OwlMail 过滤功能更强大：**
- 全文搜索（`?q=`）：搜索主题、文本内容、HTML 内容
- 按发送者过滤（`?from=`）
- 按接收者过滤（`?to=`）
- 按日期范围过滤（`?dateFrom=`、`?dateTo=`）
- 按已读状态过滤（`?read=true/false`）
- 支持排序（`?sortBy=time/subject`、`?sortOrder=asc/desc`）

**MailDev 过滤功能：**
- 支持点号语法访问嵌套字段（如 `headers.to=value`）
- 支持任意字段的精确匹配

#### 6. 批量操作

| 功能 | OwlMail | MailDev |
|------|---------|---------|
| 批量删除 | ✅ | ❌ |
| 批量标记已读 | ✅ | ❌ |
| 邮件导出 | ✅ (ZIP) | ❌ |

#### 7. 环境变量兼容性

| 项目 | 兼容性 | 说明 |
|------|--------|------|
| OwlMail | ✅ 完全兼容 | 优先使用 MailDev 环境变量，如果不存在则使用 OwlMail 环境变量 |
| MailDev | ✅ | 仅支持 MailDev 环境变量 |

**OwlMail 环境变量兼容性特性：**
- ✅ 完全支持所有 MailDev 环境变量（23 个环境变量）
- ✅ 优先使用 MailDev 环境变量，如果不存在则回退到 OwlMail 环境变量
- ✅ 无需修改现有环境变量配置即可从 MailDev 迁移到 OwlMail
- ✅ 支持 MailDev 日志级别环境变量（`MAILDEV_VERBOSE`、`MAILDEV_SILENT`）

**支持的环境变量映射：**
- SMTP 服务器配置：`MAILDEV_SMTP_PORT`、`MAILDEV_IP`、`MAILDEV_MAIL_DIRECTORY`
- Web API 配置：`MAILDEV_WEB_PORT`、`MAILDEV_WEB_IP`、`MAILDEV_WEB_USER`、`MAILDEV_WEB_PASS`
- HTTPS 配置：`MAILDEV_HTTPS`、`MAILDEV_HTTPS_CERT`、`MAILDEV_HTTPS_KEY`
- 出站邮件配置：`MAILDEV_OUTGOING_HOST`、`MAILDEV_OUTGOING_PORT`、`MAILDEV_OUTGOING_USER`、`MAILDEV_OUTGOING_PASS`、`MAILDEV_OUTGOING_SECURE`
- 自动中继配置：`MAILDEV_AUTO_RELAY`、`MAILDEV_AUTO_RELAY_ADDR`、`MAILDEV_AUTO_RELAY_RULES`
- SMTP 认证配置：`MAILDEV_INCOMING_USER`、`MAILDEV_INCOMING_PASS`
- TLS 配置：`MAILDEV_INCOMING_SECURE`、`MAILDEV_INCOMING_CERT`、`MAILDEV_INCOMING_KEY`
- 日志级别：`MAILDEV_VERBOSE`、`MAILDEV_SILENT`（对应 `OWLMAIL_LOG_LEVEL`）

## 技术栈对比

| 方面 | OwlMail | MailDev |
|------|---------|---------|
| 语言 | Go 1.24 | Node.js (>=18.0.0) |
| Web 框架 | Gin | Express |
| SMTP 库 | emersion/go-smtp | smtp-server |
| 邮件解析 | emersion/go-message | mailparser-mit |
| WebSocket | gorilla/websocket | Socket.io |
| 前端 | 原生 JS | AngularJS |
| 依赖管理 | go.mod | package.json |

## 性能对比

| 方面 | OwlMail | MailDev |
|------|---------|---------|
| 启动速度 | ⚡ 快（编译后二进制） | 🐢 较慢（需要 Node.js 运行时） |
| 内存占用 | 💚 低（Go 编译） | 🟡 中等（Node.js） |
| 并发处理 | 💚 优秀（Go 协程） | 🟡 良好（Node.js 事件循环） |
| 资源消耗 | 💚 低 | 🟡 中等 |

## 兼容性分析

### ✅ 可以直接替换的场景

1. **基本邮件接收和查看**
   - 两者都支持 SMTP 接收邮件
   - 两者都提供 Web UI 查看邮件
   - API 端点基本兼容

2. **邮件转发功能**
   - 两者都支持配置出站 SMTP
   - 两者都支持手动和自动中继

3. **开发测试环境**
   - 两者都适合作为开发测试工具
   - 默认端口相同（SMTP: 1025, Web: 1080）

### ⚠️ 需要注意的差异

1. **WebSocket 客户端**
   - 如果前端使用 Socket.io，需要修改为原生 WebSocket
   - OwlMail 使用 `/socket.io` 路径，但实现是原生 WebSocket

2. **API 端点差异**
   - OwlMail 提供更多批量操作端点（批量删除、批量标记已读）
   - OwlMail 提供更完善的配置管理 API（GET/PUT/PATCH）
   - 转发邮件：两者都支持 URL 参数，OwlMail 还支持请求体传递

3. **自动中继规则**
   - 两者都完全支持 JSON 文件配置规则（`--auto-relay-rules`）
   - 规则格式和处理逻辑完全兼容

4. **Web UI**
   - 界面语言不同（中文 vs 英文）
   - 前端框架不同，如果需要自定义需要重写

5. **环境变量兼容性**
   - ✅ OwlMail 完全支持 MailDev 环境变量，无需修改现有配置
   - ✅ 优先使用 MailDev 环境变量，如果不存在则使用 OwlMail 环境变量
   - ✅ 支持所有 23 个 MailDev 环境变量映射

### ❌ 不能直接替换的场景

1. **依赖 Socket.io 的客户端**
   - 如果现有客户端使用 Socket.io 库，需要修改为原生 WebSocket
   - OwlMail 使用原生 WebSocket，虽然路径是 `/socket.io`，但协议不同

## 迁移建议

### 如果要从 MailDev 迁移到 OwlMail：

1. **更新 WebSocket 客户端**
   ```javascript
   // MailDev (Socket.io)
   const socket = io('/socket.io');
   
   // OwlMail (原生 WebSocket)
   const ws = new WebSocket('ws://localhost:1080/socket.io');
   ```

2. **更新 API 调用**
   - 批量操作：使用 OwlMail 的批量端点（MailDev 不支持）
   - 转发邮件：两者都支持 URL 参数，OwlMail 还支持请求体传递
   - 配置管理：使用 OwlMail 的配置端点（MailDev 仅支持 GET）
   - 邮件过滤：OwlMail 提供更强大的过滤功能（全文搜索、多条件过滤）

3. **环境变量兼容性（无需修改）**
   
   **✅ OwlMail 完全支持 MailDev 环境变量，无需修改现有配置！**
   
   OwlMail 会自动识别并使用 MailDev 环境变量，如果 MailDev 环境变量不存在，则使用 OwlMail 环境变量。
   
   **环境变量映射关系：**
   ```
   # SMTP 服务器配置
   MAILDEV_SMTP_PORT → OWLMAIL_SMTP_PORT
   MAILDEV_IP → OWLMAIL_SMTP_HOST
   MAILDEV_MAIL_DIRECTORY → OWLMAIL_MAIL_DIR
   
   # Web API 配置
   MAILDEV_WEB_PORT → OWLMAIL_WEB_PORT
   MAILDEV_WEB_IP → OWLMAIL_WEB_HOST
   MAILDEV_WEB_USER → OWLMAIL_WEB_USER
   MAILDEV_WEB_PASS → OWLMAIL_WEB_PASSWORD
   
   # HTTPS 配置
   MAILDEV_HTTPS → OWLMAIL_HTTPS_ENABLED
   MAILDEV_HTTPS_CERT → OWLMAIL_HTTPS_CERT
   MAILDEV_HTTPS_KEY → OWLMAIL_HTTPS_KEY
   
   # 出站邮件配置
   MAILDEV_OUTGOING_HOST → OWLMAIL_OUTGOING_HOST
   MAILDEV_OUTGOING_PORT → OWLMAIL_OUTGOING_PORT
   MAILDEV_OUTGOING_USER → OWLMAIL_OUTGOING_USER
   MAILDEV_OUTGOING_PASS → OWLMAIL_OUTGOING_PASSWORD
   MAILDEV_OUTGOING_SECURE → OWLMAIL_OUTGOING_SECURE
   
   # 自动中继配置
   MAILDEV_AUTO_RELAY → OWLMAIL_AUTO_RELAY
   MAILDEV_AUTO_RELAY_ADDR → OWLMAIL_AUTO_RELAY_ADDR
   MAILDEV_AUTO_RELAY_RULES → OWLMAIL_AUTO_RELAY_RULES  # 两者完全兼容
   
   # SMTP 认证配置
   MAILDEV_INCOMING_USER → OWLMAIL_SMTP_USER
   MAILDEV_INCOMING_PASS → OWLMAIL_SMTP_PASSWORD
   
   # TLS 配置
   MAILDEV_INCOMING_SECURE → OWLMAIL_TLS_ENABLED
   MAILDEV_INCOMING_CERT → OWLMAIL_TLS_CERT
   MAILDEV_INCOMING_KEY → OWLMAIL_TLS_KEY
   
   # 日志级别
   MAILDEV_VERBOSE → verbose (对应 OWLMAIL_LOG_LEVEL=verbose)
   MAILDEV_SILENT → silent (对应 OWLMAIL_LOG_LEVEL=silent)
   OWLMAIL_LOG_LEVEL → normal/verbose/silent (OwlMail 独有)
   ```
   
   **使用示例：**
   ```bash
   # 直接使用 MailDev 环境变量（无需修改）
   export MAILDEV_SMTP_PORT=1025
   export MAILDEV_WEB_PORT=1080
   export MAILDEV_OUTGOING_HOST=smtp.gmail.com
   
   # 或者使用 OwlMail 环境变量（回退）
   export OWLMAIL_SMTP_PORT=1025
   export OWLMAIL_WEB_PORT=1080
   ```

## 总结

### 功能一致性：⭐⭐⭐⭐⭐ (5/5)

**核心功能完全一致**，两者都提供了完整的邮件开发测试工具功能。主要差异在于：
- API 端点的扩展功能（OwlMail 提供更多批量操作和配置管理功能）
- WebSocket 实现方式（OwlMail 使用原生 WebSocket，MailDev 使用 Socket.io）
- Web UI 界面和语言（OwlMail 中文界面，MailDev 英文界面）
- **环境变量兼容性（OwlMail 完全支持 MailDev 环境变量，无需修改配置）**

### 可替换性：⭐⭐⭐⭐⭐ (5/5)

**在大多数场景下可以无缝替换**，需要注意：
- ✅ 基本邮件接收和查看功能完全兼容
- ✅ 邮件转发功能完全兼容（包括 URL 参数方式）
- ✅ 自动中继规则配置完全兼容（JSON 文件格式一致）
- ✅ 所有 MailDev 的 API 端点 OwlMail 都支持
- ✅ **环境变量完全兼容，无需修改现有配置**（OwlMail 优先使用 MailDev 环境变量）
- ⚠️ 需要修改 WebSocket 客户端代码（从 Socket.io 改为原生 WebSocket）
- ✅ OwlMail 提供更多扩展功能（批量操作、邮件导出、统计等）

### 推荐使用场景

**使用 OwlMail：**
- 需要更好的性能和资源效率
- 需要批量操作和邮件导出功能
- 偏好 Go 语言生态
- 需要中文界面

**使用 MailDev：**
- 需要 Socket.io 的额外功能（自动重连、房间等）
- 需要暗色主题
- 偏好 Node.js 生态
- 需要点号语法的灵活过滤（如 `headers.to=value`）

## 结论

**OwlMail 和 MailDev 在核心功能上完全一致，可以作为替代方案使用。** OwlMail 不仅实现了 MailDev 的所有核心功能，还提供了更多扩展功能（批量操作、邮件导出、统计、更强大的过滤等）。自动中继规则配置格式完全兼容，可以直接使用相同的 JSON 配置文件。

**替换建议：**
- ✅ 对于简单的开发测试场景，两者可以无缝替换
- ✅ 对于需要批量操作和邮件导出的场景，OwlMail 更适合
- ✅ **环境变量完全兼容，无需修改现有配置即可迁移**
- ⚠️ 对于依赖 Socket.io 的客户端，需要修改为原生 WebSocket
- ⚠️ 对于需要暗色主题的场景，需要等待 OwlMail 支持或使用 MailDev

**总体评价：** OwlMail 是 MailDev 的优秀替代方案，在保持完全兼容的同时提供了更多实用功能，性能更优，资源占用更低。**OwlMail 完全支持 MailDev 环境变量，使得从 MailDev 迁移到 OwlMail 变得非常简单，无需修改任何环境变量配置。**

